(function(e,t){"object"===typeof exports&&"object"===typeof module?module.exports=t():"function"===typeof define&&define.amd?define([],t):"object"===typeof exports?exports["plugin-jessica"]=t():e["plugin-jessica"]=t()})("undefined"!==typeof self?self:this,(function(){return function(e){var t={};function r(n){if(t[n])return t[n].exports;var o=t[n]={i:n,l:!1,exports:{}};return e[n].call(o.exports,o,o.exports,r),o.l=!0,o.exports}return r.m=e,r.c=t,r.d=function(e,t,n){r.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},r.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.t=function(e,t){if(1&t&&(e=r(e)),8&t)return e;if(4&t&&"object"===typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(r.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var o in e)r.d(n,o,function(t){return e[t]}.bind(null,o));return n},r.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="",r(r.s="fb15")}({"86f2":function(e,t,r){"use strict";var n=r("f0e4"),o=r.n(n);o.a},f0e4:function(e,t,r){},f6fd:function(e,t){(function(e){var t="currentScript",r=e.getElementsByTagName("script");t in e||Object.defineProperty(e,t,{get:function(){try{throw new Error}catch(n){var e,t=(/.*at [^\(]*\((.*):.+:.+\)$/gi.exec(n.stack)||[!1])[1];for(e in r)if(r[e].src==t||"interactive"==r[e].readyState)return r[e];return null}}})})(document)},fb15:function(e,t,r){"use strict";var n;(r.r(t),"undefined"!==typeof window)&&(r("f6fd"),(n=window.document.currentScript)&&(n=n.src.match(/(.+\/)[^/]+\.js(\?.*)?$/))&&(r.p=n[1]));var o=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",{directives:[{name:"loading",rawName:"v-loading",value:null==e.Rooms,expression:"Rooms==null"}]},[r("mu-data-table",{attrs:{columns:e.columns,data:e.Rooms,"min-col-width":50},on:{"row-dblclick":e.preview,"row-click":function(t){return e.$toast.message("双击预览")}},scopedSlots:e._u([{key:"default",fn:function(t){return[r("td",{staticClass:"is-center"},[e._v(e._s(t.row.StreamPath))]),r("td",{staticClass:"is-center"},[e._v(e._s(t.row.Type||"await"))]),r("td",{staticClass:"is-center"},[r("StartTime",{attrs:{value:t.row.StartTime}})],1),r("td",{staticClass:"is-center"},[e._v(e._s(e.SoundFormat(t.row.AudioInfo.SoundFormat)))]),r("td",{staticClass:"is-center"},[e._v(e._s(e.SoundRate(t.row.AudioInfo.SoundRate)))]),r("td",{staticClass:"is-center"},[e._v(e._s(t.row.AudioInfo.SoundType))]),r("td",{staticClass:"is-center"},[e._v(e._s(e.CodecID(t.row.VideoInfo.CodecID)))]),r("td",{staticClass:"is-center"},[e._v(e._s(t.row.VideoInfo.SPSInfo.Width)+"x"+e._s(t.row.VideoInfo.SPSInfo.Height))]),r("td",{staticClass:"is-center"},[e._v(e._s(t.row.AudioInfo.PacketCount)+"/"+e._s(t.row.VideoInfo.PacketCount))]),r("td",{staticClass:"is-center"},[e._v(e._s(e.getSubscriberCount(t.row)))])]}}])}),r("Jessibuca",{ref:"jessibuca",attrs:{videoCodec:e.currentStream&&e.CodecID(e.currentStream.VideoInfo.CodecID),audioCodec:e.currentStream&&e.SoundFormat(e.currentStream.AudioInfo.SoundFormat)},model:{value:e.showPreview,callback:function(t){e.showPreview=t},expression:"showPreview"}}),r("Subscribers",{attrs:{data:e.currentStream&&e.currentStream.SubscriberInfo||[]},model:{value:e.showSubscribers,callback:function(t){e.showSubscribers=t},expression:"showSubscribers"}})],1)},a=[],s=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("Modal",e._g(e._b({attrs:{draggable:"",title:e.url},on:{"on-ok":e.onClosePreview,"on-cancel":e.onClosePreview}},"Modal",e.$attrs,!1),e.$listeners),[r("canvas",{staticStyle:{background:"black"},attrs:{id:"canvas",width:"488",height:"275"}}),r("div",{attrs:{slot:"footer"},slot:"footer"},[e.audioEnabled?r("Button",{attrs:{icon:"md-volume-up"},on:{click:e.turnOff}}):r("Button",{attrs:{icon:"md-volume-off"},on:{click:e.turnOn}})],1)])},i=[];let c=null;var l={name:"Jessibuca",props:{audioCodec:String,videoCodec:String},data(){return{audioEnabled:!0,url:"",decoderTable:{AAC_AVC:"ff",AAC_H265:"hevc_aac",MP3_AVC:"ff_mp3",MP3_H265:"hevc_mp3",AVC:"ff",H265:"hevc_aac"}}},watch:{audioEnabled(e){c.audioEnabled(e)},decoder(e){c&&c.destroy(),c=new window.Jessibuca({canvas:document.getElementById("canvas"),decoder:e})}},computed:{decoder(){let e=this.decoderTable[this.audioCodec+"_"+this.videoCodec];return e||(e=this.decoderTable[this.videoCodec]||"ff"),"jessibuca/"+e+".js"}},mounted(){let e=document.createElement("script");e.src="/jessibuca/renderer.js",e.onload=function(){e.onload=null,c=new window.Jessibuca({canvas:document.getElementById("canvas"),decoder:"jessibuca/ff.js"})},this.$root.$el.append(e)},methods:{play(e){this.url=e,c.play(e)},onClosePreview(){c.close()},destroy(){c.destroy()},turnOn(){this.audioEnabled=!0},turnOff(){this.audioEnabled=!1}}},u=l;function d(e,t,r,n,o,a,s,i){var c,l="function"===typeof e?e.options:e;if(t&&(l.render=t,l.staticRenderFns=r,l._compiled=!0),n&&(l.functional=!0),a&&(l._scopeId="data-v-"+a),s?(c=function(e){e=e||this.$vnode&&this.$vnode.ssrContext||this.parent&&this.parent.$vnode&&this.parent.$vnode.ssrContext,e||"undefined"===typeof __VUE_SSR_CONTEXT__||(e=__VUE_SSR_CONTEXT__),o&&o.call(this,e),e&&e._registeredComponents&&e._registeredComponents.add(s)},l._ssrRegister=c):o&&(c=i?function(){o.call(this,this.$root.$options.shadowRoot)}:o),c)if(l.functional){l._injectStyles=c;var u=l.render;l.render=function(e,t){return c.call(t),u(e,t)}}else{var d=l.beforeCreate;l.beforeCreate=d?[].concat(d,c):[c]}return{exports:e,options:l}}var f=d(u,s,i,!1,null,"6ae4b67f",null),m=f.exports,p=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("Modal",e._g(e._b({attrs:{draggable:"",title:"查看订阅者"}},"Modal",e.$attrs,!1),e.$listeners),[r("Table",{attrs:{columns:e.subtableColumns,data:e.data}})],1)},h=[],b=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("Poptip",{attrs:{trigger:"hover",content:"⌚️"+new Date(e.value).toLocaleString()}},[r("Time",{attrs:{time:new Date(e.value)}})],1)},v=[],S={name:"StartTime",props:{value:String}},_=S,g=d(_,b,v,!1,null,"062b9730",null),w=g.exports,y={props:{data:Array},data(){return{subtableColumns:[{title:"类型",key:"Type"},{title:"Name",key:"ID"},{title:"订阅时间",render(e,{row:t}){return e(w,{props:{value:t.SubscribeTime}})}},{title:"丢帧",render(e,{row:t}){return e("span",t.TotalPacket?t.TotalDrop+"/"+t.TotalPacket:"")}},{title:"Buffer",render(e,{row:t}){return e("Progress",{props:{percent:Math.floor(99*t.BufferLength/1024),"text-inside":!0,"stroke-width":20,"stroke-color":["#87d068","#ff0000"]}})}}]}}},C=y,P=d(C,p,h,!1,null,null,null),A=P.exports;const I={0:"Linear PCM, platform endian",1:"ADPCM",2:"MP3",3:"Linear PCM, little endian",4:"Nellymoser 16kHz mono",5:"Nellymoser 8kHz mono",6:"Nellymoser",7:"G.711 A-law logarithmic PCM",8:"G.711 mu-law logarithmic PCM",9:"reserved",10:"AAC",11:"Speex",14:"MP3 8Khz",15:"Device-specific sound"},T={1:"JPEG (currently unused)",2:"Sorenson H.263",3:"Screen video",4:"On2 VP6",5:"On2 VP6 with alpha channel",6:"Screen video version 2",7:"AVC",12:"H265"};let j=null;var x={components:{Jessibuca:m,Subscribers:A,StartTime:w},props:{ListenAddr:String},data(){return{showPreview:!1,currentStream:null,showSubscribers:!1,Rooms:null,columns:[{title:"房间",name:"StreamPath",sortable:!0,align:"center",cellAlign:"center"},{title:"类型",name:"Type",sortable:!0,align:"center",cellAlign:"center"},{title:"开始时间",name:"StartTime",sortable:!0,align:"center",cellAlign:"center"},{title:"音频格式",name:"AudioInfo",align:"center",cellAlign:"center"},{title:"采样率",name:"AudioInfo",align:"center",cellAlign:"center"},{title:"声道",name:"AudioInfo",align:"center",cellAlign:"center"},{title:"视频格式",name:"VideoInfo",align:"center",cellAlign:"center"},{title:"分辨率",name:"VideoInfo",align:"center",cellAlign:"center"},{title:"数据包",name:"",align:"center",cellAlign:"center"},{title:"订阅者",name:"Subscribes",align:"center",cellAlign:"center"}]}},computed:{host(){return location.hostname+":"+this.ListenAddr.split(":").pop()}},methods:{getSubscriberCount(e){return this.currentStream&&this.currentStream.StreamPath==e.StreamPath&&(this.currentStream=e),e.SubscriberInfo?e.SubscriberInfo.length:0},preview(e,t,r){this.currentStream=t,this.onPlay("ws://"+this.host+"/"+t.StreamPath)},onPlay(e){this.showPreview=!0,this.$nextTick(()=>this.$refs.jessibuca.play(e))},SoundFormat(e){return I[e]},CodecID(e){return T[e]},SoundRate(e){return e>1e3?e/1e3+"kHz":e+"Hz"},onShowDetail(e){this.showSubscribers=!0,this.currentStream=e},fetchSummary(){j=new EventSource("/api/summary"),j.onmessage=e=>{if(!e.data)return;let t=JSON.parse(e.data);t.Address=location.hostname,t.Rooms||(t.Rooms=[]),t.Rooms.sort((e,t)=>e.StreamPath>t.StreamPath?1:-1),this.Rooms=t.Rooms}}},mounted(){console.log(this),this.fetchSummary()},destroyed(){j.close(),this.$refs.jessibuca.destroy()}},k=x,$=(r("86f2"),d(k,o,a,!1,null,"467c9f3d",null)),E=$.exports;t["default"]=E}})["default"]}));
//# sourceMappingURL=plugin-jessica.umd.min.js.map