(function(e,t){"object"===typeof exports&&"object"===typeof module?module.exports=t():"function"===typeof define&&define.amd?define([],t):"object"===typeof exports?exports["plugin-jessica"]=t():e["plugin-jessica"]=t()})("undefined"!==typeof self?self:this,(function(){return function(e){var t={};function r(o){if(t[o])return t[o].exports;var n=t[o]={i:o,l:!1,exports:{}};return e[o].call(n.exports,n,n.exports,r),n.l=!0,n.exports}return r.m=e,r.c=t,r.d=function(e,t,o){r.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:o})},r.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.t=function(e,t){if(1&t&&(e=r(e)),8&t)return e;if(4&t&&"object"===typeof e&&e&&e.__esModule)return e;var o=Object.create(null);if(r.r(o),Object.defineProperty(o,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var n in e)r.d(o,n,function(t){return e[t]}.bind(null,n));return o},r.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="",r(r.s="fb15")}({"034f":function(e,t,r){"use strict";var o=r("85ec"),n=r.n(o);n.a},"85ec":function(e,t,r){},f6fd:function(e,t){(function(e){var t="currentScript",r=e.getElementsByTagName("script");t in e||Object.defineProperty(e,t,{get:function(){try{throw new Error}catch(o){var e,t=(/.*at [^\(]*\((.*):.+:.+\)$/gi.exec(o.stack)||[!1])[1];for(e in r)if(r[e].src==t||"interactive"==r[e].readyState)return r[e];return null}}})})(document)},fb15:function(e,t,r){"use strict";var o;(r.r(t),"undefined"!==typeof window)&&(r("f6fd"),(o=window.document.currentScript)&&(o=o.src.match(/(.+\/)[^/]+\.js(\?.*)?$/))&&(r.p=o[1]));var n=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",[null==e.Rooms?r("Spin",{attrs:{fix:""}},[r("Icon",{staticClass:"demo-spin-icon-load",attrs:{type:"ios-loading",size:"18"}}),r("div",[e._v("Loading")])],1):0==e.Rooms.length?r("div",{staticClass:"empty"},[r("Icon",{attrs:{type:"md-wine",size:"50"}}),e._v("没有任何房间 ")],1):r("div",{staticClass:"layout"},e._l(e.Rooms,(function(t){return r("Card",{key:t.StreamPath,staticClass:"room",attrs:{title:t.StreamPath}},[r("Tag",{attrs:{slot:"extra",color:"purple"},slot:"extra"},[e._v(e._s(t.Type||"await"))]),t.Type?r("p",[e._v(" "+e._s(e.SoundFormat(t.AudioInfo.SoundFormat))+" "+e._s(t.AudioInfo.PacketCount)+" "+e._s(e.SoundRate(t.AudioInfo.SoundRate))+" 声道:"+e._s(t.AudioInfo.SoundType)+" ")]):e._e(),t.Type?r("p",[e._v(" "+e._s(e.CodecID(t.VideoInfo.CodecID))+" "+e._s(t.VideoInfo.PacketCount)+" "+e._s(t.VideoInfo.SPSInfo.Width)+"x"+e._s(t.VideoInfo.SPSInfo.Height)+" ")]):e._e(),r("p",[e._v(" 创建时间："),r("StartTime",{attrs:{value:t.StartTime}})],1),r("ButtonGroup",{attrs:{size:"small"}},[r("Button",{attrs:{icon:"ios-people"},on:{click:function(r){return e.onShowDetail(t)}}},[e._v(e._s(e.getSubscriberCount(t)))]),t.Type?r("Button",{attrs:{icon:"md-eye"},on:{click:function(r){return e.preview(t)}}}):e._e()],1)],1)})),1),r("Jessibuca",{ref:"jessibuca",attrs:{videoCodec:e.currentStream&&e.CodecID(e.currentStream.VideoInfo.CodecID),audioCodec:e.currentStream&&e.SoundFormat(e.currentStream.AudioInfo.SoundFormat)},model:{value:e.showPreview,callback:function(t){e.showPreview=t},expression:"showPreview"}}),r("Subscribers",{attrs:{data:e.currentStream&&e.currentStream.SubscriberInfo||[]},model:{value:e.showSubscribers,callback:function(t){e.showSubscribers=t},expression:"showSubscribers"}})],1)},a=[],s=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("Modal",e._g(e._b({attrs:{draggable:"",title:e.url},on:{"on-ok":e.onClosePreview,"on-cancel":e.onClosePreview}},"Modal",e.$attrs,!1),e.$listeners),[r("canvas",{staticStyle:{background:"black"},attrs:{id:"canvas",width:"488",height:"275"}}),r("div",{attrs:{slot:"footer"},slot:"footer"},[e.audioEnabled?r("Button",{attrs:{icon:"md-volume-up"},on:{click:e.turnOff}}):r("Button",{attrs:{icon:"md-volume-off"},on:{click:e.turnOn}})],1)])},i=[];let u=null;var c={name:"Jessibuca",props:{audioCodec:String,videoCodec:String},data(){return{audioEnabled:!0,url:"",decoderTable:{AAC_AVC:"ff",AAC_H265:"hevc_aac",MP3_AVC:"ff_mp3",MP3_H265:"hevc_mp3",AVC:"ff",H265:"hevc_aac"}}},watch:{audioEnabled(e){u.audioEnabled(e)},decoder(e){u&&u.destroy(),u=new window.Jessibuca({canvas:document.getElementById("canvas"),decoder:e})}},computed:{decoder(){let e=this.decoderTable[this.audioCodec+"_"+this.videoCodec];return e||(e=this.decoderTable[this.videoCodec]||"ff"),"jessibuca/"+e+".js"}},mounted(){let e=document.createElement("script");e.src="/jessibuca/renderer.js",e.onload=function(){e.onload=null,u=new window.Jessibuca({canvas:document.getElementById("canvas"),decoder:"jessibuca/ff.js"})},this.$root.$el.append(e)},methods:{play(e){this.url=e,u.play(e)},onClosePreview(){u.close()},destroy(){u.destroy()},turnOn(){this.audioEnabled=!0},turnOff(){this.audioEnabled=!1}}},l=c;function d(e,t,r,o,n,a,s,i){var u,c="function"===typeof e?e.options:e;if(t&&(c.render=t,c.staticRenderFns=r,c._compiled=!0),o&&(c.functional=!0),a&&(c._scopeId="data-v-"+a),s?(u=function(e){e=e||this.$vnode&&this.$vnode.ssrContext||this.parent&&this.parent.$vnode&&this.parent.$vnode.ssrContext,e||"undefined"===typeof __VUE_SSR_CONTEXT__||(e=__VUE_SSR_CONTEXT__),n&&n.call(this,e),e&&e._registeredComponents&&e._registeredComponents.add(s)},c._ssrRegister=u):n&&(u=i?function(){n.call(this,this.$root.$options.shadowRoot)}:n),u)if(c.functional){c._injectStyles=u;var l=c.render;c.render=function(e,t){return u.call(t),l(e,t)}}else{var d=c.beforeCreate;c.beforeCreate=d?[].concat(d,u):[u]}return{exports:e,options:c}}var f=d(l,s,i,!1,null,null,null),p=f.exports,m=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("Modal",e._g(e._b({attrs:{draggable:"",title:"查看订阅者"}},"Modal",e.$attrs,!1),e.$listeners),[r("Table",{attrs:{columns:e.subtableColumns,data:e.data}})],1)},h=[],v=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("Poptip",{attrs:{trigger:"hover",content:"⌚️"+new Date(e.value).toLocaleString()}},[r("Time",{attrs:{time:new Date(e.value)}})],1)},b=[],S={name:"StartTime",props:{value:String}},_=S,y=d(_,v,b,!1,null,"062b9730",null),w=y.exports,C={props:{data:Array},data(){return{subtableColumns:[{title:"类型",key:"Type"},{title:"Name",key:"ID"},{title:"订阅时间",render(e,{row:t}){return e(w,{props:{value:t.SubscribeTime}})}},{title:"丢帧",render(e,{row:t}){return e("span",t.TotalPacket?t.TotalDrop+"/"+t.TotalPacket:"")}},{title:"Buffer",render(e,{row:t}){return e("Progress",{props:{percent:Math.floor(99*t.BufferLength/1024),"text-inside":!0,"stroke-width":20,"stroke-color":["#87d068","#ff0000"]}})}}]}}},g=C,P=d(g,m,h,!1,null,null,null),T=P.exports;const x={0:"Linear PCM, platform endian",1:"ADPCM",2:"MP3",3:"Linear PCM, little endian",4:"Nellymoser 16kHz mono",5:"Nellymoser 8kHz mono",6:"Nellymoser",7:"G.711 A-law logarithmic PCM",8:"G.711 mu-law logarithmic PCM",9:"reserved",10:"AAC",11:"Speex",14:"MP3 8Khz",15:"Device-specific sound"},I={1:"JPEG (currently unused)",2:"Sorenson H.263",3:"Screen video",4:"On2 VP6",5:"On2 VP6 with alpha channel",6:"Screen video version 2",7:"AVC",12:"H265"};let j=null;var k={components:{Jessibuca:p,Subscribers:T,StartTime:w},props:{listenaddr:String},data(){return{showPreview:!1,currentStream:null,showSubscribers:!1,typeMap:{Receiver:"📡",FlvFile:"🎥",TS:"🎬",HLS:"🍎","":"⏳",Match365:"🏆",RTMP:"🚠"},Rooms:null}},computed:{host(){return location.hostname+":"+this.listenaddr.split(":").pop()}},methods:{getSubscriberCount(e){return this.currentStream&&this.currentStream.StreamPath==e.StreamPath&&(this.currentStream=e),e.SubscriberInfo?e.SubscriberInfo.length:0},preview(e){this.currentStream=e,this.onPlay("ws://"+this.host+"/"+e.StreamPath)},onPlay(e){this.showPreview=!0,this.$nextTick(()=>this.$refs.jessibuca.play(e))},SoundFormat(e){return x[e]},CodecID(e){return I[e]},SoundRate(e){return e>1e3?e/1e3+"kHz":e+"Hz"},onShowDetail(e){this.showSubscribers=!0,this.currentStream=e},fetchSummary(){j=new EventSource("/api/summary"),j.onmessage=e=>{if(!e.data)return;let t=JSON.parse(e.data);t.Address=location.hostname,t.Rooms||(t.Rooms=[]),t.Rooms.sort((e,t)=>e.StreamPath>t.StreamPath?1:-1),this.Rooms=t.Rooms}}},mounted(){this.fetchSummary()},deactivated(){j.close(),this.$refs.jessibuca.destroy()}},E=k,M=(r("034f"),d(E,n,a,!1,null,null,null)),$=M.exports;t["default"]=$}})["default"]}));
//# sourceMappingURL=plugin-jessica.umd.min.js.map